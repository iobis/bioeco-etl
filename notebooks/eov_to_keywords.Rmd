---
title: GOOS BioEco portal: move EOVs to keywords
date: "`r Sys.Date()`"
author: Pieter Provoost
#output: (function(...) { rmdformats::robobook(toc_depth = 3, pandoc_args = c("+RTS", "-K2000m", "-RTS"), ...) })
#output: bookdown::pdf_document2: latex_engine: lualatex
output:
  pdf_document:
    latex_engine: xelatex
editor_options: 
  chunk_output_type: console
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../docs") })  
---

This notebook backs up EOV/network links from GeoNode and restores them as keywords.

# Configuration

```{r warning = FALSE, message = FALSE}
database_host <- "geonode.goosocean.org"
```

# Load packages

```{r warning = FALSE, message = FALSE}
library(dplyr)
library(DBI)
library(tidyr)
library(readr)
library(purrr)
library(glue)
library(RPostgres)
```

# Read links

```{r warning=FALSE, message=FALSE, eval=FALSE}
con <- DBI::dbConnect(RPostgres::Postgres(), dbname = "geonode", host = database_host, port = 5432, user = "geonode", password = "geonode")

layers_layer_eovs <- dbSendQuery(con, "select l.layer_id, e.id as eov_id, e.short_name from layers_layer_eovs l left join goos_eov e on l.eov_id = e.id") %>%
  dbFetch()

write.csv(layers_layer_eovs, file = "../data/layers_layer_eovs.csv", row.names = FALSE)
```
